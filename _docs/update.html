<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta name="format-detection" content="telephone=no,email=no" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
  <meta name="description" content="description of your site">
  <meta name="author" content="author of the site">
  <title>YIcon 如何升级</title>
  <link rel="stylesheet" href="source/main.css"/>
  
  
    
        <link rel="stylesheet" href="./theme/yicon.css"/>
    
  
</head>
<body class=update >
    <div class="ydoc">
      <header class="ydoc-header">
        <div class="ydoc-header-area">
            
            <a href="http://ymfe.tech/" class="navbar-brand">YMFE</a>
            
            <button class="ydocIcon navbar-toggle">&#xf020;</button>
            <nav class="ydoc-nav">
              <ul class="navbar-left">
                
                    
                    <li class="">
                        
                        <a href="index.html">YIcon</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="introduction.html">简介</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="build.html">如何部署</a>
                        
                    </li>
                    
                    <li class="active">
                        
                        <a href="update.html">如何升级</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="usage.html">使用说明</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="source.html">source 接口</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="releases.html">版本</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="https://github.com/YMFE/yicon" target="_blank">Github</a>
                        
                    </li>
                    
                
              </ul>
            </nav>
        </div>
    </header>
    
    <!-- <header style="height:20px"></header> -->
    
      <!-- Docs page layout -->
      
      <div class="ydoc-banner-bg">
          <div class="ydoc-banner">
              <div class="ydoc-banner-area">
                  <h1>版本升级</h1>
                  <p class="desc">及时解锁 YIcon 新特性，畅快体验新功能。</p>
              </div>
          </div>
      

      <div class="ydoc-container">
        
          
          <div class="ydoc-container-content" id="readme">
              <article class="markdown-body">
                  
                  <h1 class="subject" id="YIcon Builder - update">YIcon Builder - update <a class="hashlink" href="#YIcon Builder - update">#</a></h1><h2 class="subject" id="升级准备">升级准备 <a class="hashlink" href="#升级准备">#</a></h2><ul>
<li>在进行升级前请先 <strong>备份数据</strong>，这是最重要的一点。</li><li><p>检查数据表结构是否正确，升级到 1.1.0 版本时，必须在 icons 表中添加 <code>description</code> 字段，projects 表添加 <code>source</code> 字段</p>
<ul>
<li><p><code>description</code> 字段</p>
<pre><code class="lang-sql">  <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> icons <span class="token keyword">ADD</span> description <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre>
</li><li><p><code>source</code> 字段</p>
<pre><code class="lang-sql">  <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> projects <span class="token keyword">ADD</span> source <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">Null</span><span class="token punctuation">;</span>
</code></pre>
</li></ul>
</li></ul>
<h2 class="subject" id="项目更新">项目更新 <a class="hashlink" href="#项目更新">#</a></h2><p>在项目目录（一般是在第一层 src 目录下）下运行</p>
<pre><code>$ yicon update
</code></pre><h3 class="subject" id="提示：输入当前版本号">提示：输入当前版本号 <a class="hashlink" href="#提示：输入当前版本号">#</a></h3><p>默认读取 package.json 文件中的 version 字段，但因为 v1.0.2 及之前的版本，package.json 中的 version 和实际版本不匹配，所以需要手动输入下正确版本</p>
<h3 class="subject" id="升级预处理">升级预处理 <a class="hashlink" href="#升级预处理">#</a></h3><p>yicon 构建工具自动进行预处理：</p>
<ul>
<li>将本地代码进行打包压缩，存储到 <code>/backups</code> 目录下，方便代码回滚</li><li>根据输入的版本号，进行本地代码，GitHub 上对应版本号的代码和最新的版本的代码进行 diff，提示用户本地代码与最新版本的代码间是否存在冲突，如果存在冲突，直接进行提示，针对不冲突、可以直接替换的文件，直接提示</li></ul>
<h3 class="subject" id="提示：是否对上述文件进行替换">提示：是否对上述文件进行替换 <a class="hashlink" href="#提示：是否对上述文件进行替换">#</a></h3><p>无论在预处理过程中，是否存在冲突，都可以针对可以直接替换的文件，进行直接替换</p>
<h2 class="subject" id="安装依赖">安装依赖 <a class="hashlink" href="#安装依赖">#</a></h2><p>与部署类似，在升级过程中，可能安装或卸载了部分模块，所以需要重新进行 install</p>
<h2 class="subject" id="项目编译">项目编译 <a class="hashlink" href="#项目编译">#</a></h2><p>与部署类似，安装依赖完成之后，会在 <code>/src</code> 目录下执行 <code>npm run build</code> 进行静态资源编译；如果编译出错，可以去项目路径中手动执行 <code>npm run build</code> 编译。</p>
<h2 class="subject" id="最后">最后 <a class="hashlink" href="#最后">#</a></h2><p>如果在升级预处理过程中，没有冲突的文件，同时在上述过程中的所有操作都成功完成，则可以执行 <code>./start.sh</code> 进行项目启动，或者自行选择使用 pm2 等工具进行启动；如果存在冲突，则需要先手动修改冲突的文件并检查无误后，再进行项目启动。</p>

              </article>
          </div>
          
        
      </div>
     
     </div>
     
      <footer class="footer">
        <div class="copyright">
            © 2017 <a href='http://ued.qunar.com/ymfe/' target='_blank'>YMFE</a> Team. Build by <a href='https://github.com/YMFE/ydoc' target='_blank'>ydoc</a>.
        </div>
      </footer>
    </div>

    
    

    <script src="source/main.js"></script>
    <script src="source/app.js"></script>
    
    

    

    
    

</body>
</html>
