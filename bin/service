#!/bin/bash

prog="forever"
USER="tomcat"
export PATH=/home/q/node/bin:$PATH

start() {
echo -n $"Starting $prog: "
exec /bin/su $USER -c "NODE_ENV=production forever start -s /home/q/www/yicon.corp.qunar.com/webapp/bin/server.js"

if [[ $? -eq 0 ]]; then
return 0
else
return 1
fi
}

stop() {
echo -n $"Stopping $prog: "
huixian=$(ps aux|grep 'node /home/q/www/yicon.corp.qunar.com/webapp/bin/server.js' | grep -v grep)
if [ -n "$huixian" ]; then
sleep 10
exec /bin/su $USER -c "forever stop /home/q/www/yicon.corp.qunar.com/webapp/bin/server.js"
fi

if [[ $? -eq 0 ]]; then
return 0
else
return 1
fi
}

case "$1" in
start)
start && exit 0
;;
stop)
stop || exit 0
;;
*)
echo $"Usage: $0 {start|stop}"
exit 2
esac
exit $?
